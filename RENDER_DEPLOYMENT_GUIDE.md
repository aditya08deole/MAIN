# ğŸš€ EvaraTech Platform - Render Deployment Guide

**Complete deployment guide for Backend (FastAPI) + Frontend (React/Vite) on Render**

---

## ğŸ“‹ What You're Deploying

- âœ… **Backend:** FastAPI Python API with Supabase PostgreSQL
- âœ… **Frontend:** React + Vite + TypeScript dashboard
- âœ… **Database:** Supabase (external, already configured)
- âœ… **Auto-deploy:** Automatically deploys on GitHub push

---

## ğŸ¯ Quick Start (5 Minutes)

### Prerequisites
- âœ… GitHub account
- âœ… Code pushed to GitHub
- âœ… Render account (sign up at https://render.com - FREE)

### Deployment Steps

#### **Step 1: Connect GitHub to Render**

1. Go to https://dashboard.render.com
2. Click **"New"** â†’ **"Blueprint"**
3. Connect your GitHub account
4. Select your repository: **`aditya08deole/MAIN`**
5. Click **"Connect"**

#### **Step 2: Deploy from render.yaml**

Render will automatically detect `render.yaml` and create 2 services:

- ğŸ”· **evara-backend** (FastAPI)
- ğŸ”¶ **evara-frontend** (React)

#### **Step 3: Click "Apply" and Wait**

- Render will deploy both services simultaneously
- â±ï¸ Backend takes ~3-5 minutes
- â±ï¸ Frontend takes ~2-3 minutes

#### **Step 4: Get Your URLs**

After deployment completes, you'll get:

```
Backend:  https://evara-backend-412x.onrender.com
Frontend: https://evara-frontend.onrender.com
```

#### **Step 5: Update Frontend to Connect to Backend**

âš ï¸ **IMPORTANT:** Update frontend environment variable

1. Go to Render dashboard
2. Click **"evara-frontend"** service
3. Go to **"Environment"** tab
4. Find **`VITE_API_URL`**
5. Update it to your backend URL:
   ```
   https://evara-backend-412x.onrender.com/api/v1
   ```
6. Click **"Save Changes"**
7. Render will auto-redeploy frontend (~2 minutes)

#### **Step 6: Update Backend CORS**

1. Click **"evara-backend"** service
2. Go to **"Environment"** tab
3. Find **`BACKEND_CORS_ORIGINS`**
4. Update to include your frontend URL:
   ```
   https://evara-frontend.onrender.com,http://localhost:5173,http://localhost:8080
   ```
5. Click **"Save Changes"**
6. Backend will auto-redeploy (~3 minutes)

---

## âœ… Verification Steps

### Test Backend:

```bash
# Health check
curl https://evara-backend-412x.onrender.com/health

# Expected response:
{
  "status": "ok",
  "version": "2.0.0",
  "services": {
    "database": "ok",
    "thingspeak": "ok"
  }
}
```

### Test Frontend:

1. Open `https://evara-frontend.onrender.com` in browser
2. You should see the login page
3. Login with your Supabase credentials
4. Check "System Health" widget â†’ Should show **"HEALTHY"**
5. Navigate to pages â†’ Data should load from backend

---

## ğŸ”§ Configuration Details

### Backend (evara-backend)

**Service Type:** Web Service (Docker)  
**Runtime:** Docker  
**Region:** Singapore  
**Health Check:** `/health`  
**Auto-deploy:** Enabled

**Environment Variables** (already configured in render.yaml):
- `ENVIRONMENT=production`
- `DATABASE_URL` - Supabase PostgreSQL (port 6543)
- `SUPABASE_URL` - https://tihrvotigvaozizlcxse.supabase.co
- `SUPABASE_KEY` - Service role key
- `SUPABASE_JWT_SECRET` - JWT secret for authentication
- `SECRET_KEY` - Auto-generated by Render
- `PORT=8000`
- `BACKEND_CORS_ORIGINS` - Comma-separated allowed origins

### Frontend (evara-frontend)

**Service Type:** Static Site  
**Build Command:** `cd client && npm install && npm run build`  
**Publish Directory:** `./client/dist`  
**Auto-deploy:** Enabled

**Environment Variables** (already configured in render.yaml):
- `VITE_API_URL` - Backend API URL
- `VITE_SUPABASE_URL` - Supabase project URL
- `VITE_SUPABASE_ANON_KEY` - Supabase anon public key

---

## ğŸ”„ How Auto-Deploy Works

Render automatically deploys when you push to GitHub:

```bash
# Make changes
git add .
git commit -m "your changes"
git push origin main

# Render automatically:
# 1. Detects the push
# 2. Rebuilds services
# 3. Deploys updates
# 4. Zero-downtime (with health checks)
```

---

## ğŸ› Troubleshooting

### Issue: Backend shows "Degraded" health status

**Cause:** Database connection failed

**Solution:**
1. Go to backend service â†’ **Environment**
2. Verify `DATABASE_URL` uses **port 6543** (not 5432)
3. Format: `postgresql+asyncpg://user:pass@host:6543/db`
4. Save and redeploy

### Issue: Frontend shows "Unable to fetch nodes"

**Cause:** Frontend can't reach backend

**Solution:**
1. Check backend is running: `curl https://your-backend.onrender.com/health`
2. Verify `VITE_API_URL` in frontend environment variables
3. Check browser console for CORS errors
4. If CORS error, update `BACKEND_CORS_ORIGINS` to include frontend URL

### Issue: CORS Error in Browser Console

**Error:** `Access-Control-Allow-Origin blocked`

**Solution:**
1. Go to backend service â†’ **Environment**
2. Update `BACKEND_CORS_ORIGINS`:
   ```
   https://your-frontend.onrender.com,http://localhost:5173
   ```
3. Save and redeploy

### Issue: Build Failed (Backend)

**Solution:**
1. Check **Logs** tab for error details
2. Common fixes:
   - Verify `server/Dockerfile` exists
   - Check `server/requirements.txt` has all dependencies
   - Ensure Python version is correct (3.12)

### Issue: Build Failed (Frontend)

**Solution:**
1. Check **Logs** tab for error message
2. Common fixes:
   - Verify `client/package.json` exists
   - Check Node version (Render uses Node 20 by default)
   - Ensure `npm run build` works locally

---

## ğŸ’° Render Free Tier

### What You Get (FREE):
- âœ… 750 hours/month combined across all services
- âœ… Automatic SSL (HTTPS)
- âœ… Auto-deploy from GitHub
- âœ… Custom domains
- âœ… Unlimited bandwidth

### Free Tier Limits:
- â±ï¸ Backend spins down after 15 minutes of inactivity
- â±ï¸ Cold start takes ~30 seconds to wake up
- ğŸ’¾ 512 MB RAM per service

### Tips to Optimize:
1. **Keep backend warm:** Use uptime monitoring (e.g., UptimeRobot) to ping `/health` every 5 minutes
2. **Static frontend:** Frontend doesn't sleep (always instant)
3. **Upgrade if needed:** $7/month for always-on backend

---

## ğŸ“Š Monitoring Your Services

### View Logs:
1. Go to service (backend or frontend)
2. Click **"Logs"** tab
3. Real-time logs appear here

### View Metrics:
1. Click **"Metrics"** tab
2. See:
   - CPU usage
   - Memory usage
   - Request count
   - Response times

### Set Up Notifications:
1. Go to **"Settings"** â†’ **"Notifications"**
2. Add email or Slack webhook
3. Get notified on:
   - Deploy success/failure
   - Service crashes
   - Health check failures

---

## ğŸ” Security Best Practices

### âœ… Already Implemented:
- Passwords URL-encoded in `DATABASE_URL`
- Supabase JWT validation
- CORS properly configured
- HTTPS/SSL enabled automatically

### âš ï¸ Recommendations:
1. **Rotate SECRET_KEY periodically**
2. **Use Render's secret management** (environment variables stored encrypted)
3. **Enable Render's DDoS protection** (automatic)
4. **Monitor logs** for suspicious activity

---

## ğŸŒ Custom Domain Setup (Optional)

### Add Custom Domain to Frontend:

1. Go to **evara-frontend** service
2. Click **"Settings"** â†’ **"Custom Domains"**
3. Click **"Add Custom Domain"**
4. Enter your domain: `app.evaratech.com`
5. Add DNS records (Render provides instructions):
   ```
   Type: CNAME
   Name: app
   Value: evara-frontend.onrender.com
   ```
6. Wait for DNS propagation (5-30 minutes)
7. SSL certificate auto-generates

### Update Backend CORS:
After adding custom domain, update `BACKEND_CORS_ORIGINS`:
```
https://app.evaratech.com,https://evara-frontend.onrender.com,...
```

---

## ğŸš€ Performance Optimization

### Backend Optimization:
1. **Enable caching** - Add Redis for API responses
2. **Database indexing** - Already implemented in migrations
3. **Connection pooling** - Already configured (pool_size=5)
4. **Background tasks** - Already using circuit breakers

### Frontend Optimization:
1. **Code splitting** - Already configured in vite.config.ts
2. **Lazy loading** - Implement for large components
3. **CDN delivery** - Render uses global CDN automatically
4. **Compression** - Gzip/Brotli enabled automatically

---

## ğŸ“š Useful Render Commands

### View Logs from CLI:

```bash
# Install Render CLI
npm install -g @renderinc/cli

# Login
render login

# View backend logs
render logs -s evara-backend

# View frontend logs
render logs -s evara-frontend

# Tail logs (real-time)
render logs -s evara-backend --tail
```

### Manual Deployment:

```bash
# Trigger manual deploy
render deploy -s evara-backend

# Deploy specific commit
render deploy -s evara-backend --commit abc123
```

---

## ğŸ†˜ Need Help?

### Render Support:
- **Community Forum:** https://community.render.com
- **Docs:** https://render.com/docs
- **Status:** https://status.render.com
- **Support Email:** support@render.com (Paid plans only)

### Common Questions:

**Q: Can I deploy both services in one click?**  
A: Yes! Using `render.yaml` blueprint deploys everything together.

**Q: How do I rollback a deployment?**  
A: Go to service â†’ **"Events"** â†’ Find previous deploy â†’ Click **"Rollback"**

**Q: Can I use my own PostgreSQL?**  
A: Yes, but Supabase already provides managed PostgreSQL with port 6543.

**Q: Is Render suitable for production?**  
A: Absolutely! Many companies use Render for production (including ours now).

**Q: Why does my backend URL have random characters?**  
A: Render auto-generates URLs. You can customize with paid plan or use custom domains.

---

## âœ¨ Post-Deployment Checklist

After successful deployment:

- [ ] Backend health check returns `{"status": "ok"}`
- [ ] Frontend loads without errors
- [ ] Login works (Supabase authentication)
- [ ] Dashboard pages load data from backend
- [ ] No CORS errors in browser console
- [ ] Backend logs show successful database connections
- [ ] Frontend correctly displays real-time data
- [ ] All API endpoints responding
- [ ] Environment variables correctly set
- [ ] Auto-deploy working on git push

---

## ğŸ‰ Success!

**Your EvaraTech platform is now live on Render!**

### Your URLs:
- ğŸ”· **Backend API:** https://evara-backend-412x.onrender.com
- ğŸ”¶ **Frontend Dashboard:** https://evara-frontend.onrender.com
- ğŸ“š **API Docs:** https://evara-backend-412x.onrender.com/docs

### Next Steps:
1. âœ… Test all functionality
2. âœ… Monitor logs for any issues
3. âœ… Set up uptime monitoring (UptimeRobot, Pingdom)
4. âœ… Consider custom domain
5. âœ… Upgrade to paid plan if needed ($7/month for always-on)

---

## ğŸ“ Quick Reference

### Key Files:
- âœ… `render.yaml` - Deployment configuration
- âœ… `server/Dockerfile` - Backend container
- âœ… `server/requirements.txt` - Python dependencies
- âœ… `client/package.json` - Frontend dependencies
- âœ… `client/vite.config.ts` - Vite build configuration

### Important Endpoints:
- `/health` - Health check
- `/docs` - Interactive API documentation (Swagger UI)
- `/api/v1/` - API base path

### Default Port Configuration:
- Backend: 8000
- Frontend (dev): 8080
- Supabase: 6543 (connection pooler)

---

**ğŸŠ CONGRATULATIONS! Your platform is production-ready!** ğŸš€

**Both backend and frontend are deployed and working seamlessly together.**

Need help? Just ask! ğŸ’¬
